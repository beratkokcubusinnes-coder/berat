generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String         @id @default(cuid())
  email          String         @unique
  username       String         @unique
  name           String?
  password       String
  bio            String?
  avatar         String?
  coverImage     String?
  location       String?
  role           String         @default("user")
  banned         Boolean        @default(false)
  banReason      String?
  warnings       Int            @default(0)
  sessionVersion Int            @default(1)
  sessions       Session[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  blogPosts      BlogPost[]
  comments       Comment[]
  favorites      Favorite[]
  followers      Follow[]       @relation("following")
  following      Follow[]       @relation("follower")
  hooks          Hook[]
  prompts        Prompt[]
  scripts        Script[]
  threads        Thread[]
  threadLikes    ThreadLike[]
  tools          Tool[]
  notifications  Notification[]
}

model Session {
  id             String   @id
  userId         String
  expiresAt      DateTime
  sessionVersion Int
  createdAt      DateTime @default(now())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Follow {
  followerId  String
  followingId String
  createdAt   DateTime @default(now())
  following   User     @relation("following", fields: [followingId], references: [id])
  follower    User     @relation("follower", fields: [followerId], references: [id])

  @@id([followerId, followingId])
}

model Thread {
  id        String       @id @default(cuid())
  slug      String       @unique
  title     String
  content   String
  prompt    String?
  mediaUrls String?
  category  String       @default("General")
  tags      String?
  views     Int          @default(0)
  authorId  String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  comments  Comment[]
  author    User         @relation(fields: [authorId], references: [id])
  likes     ThreadLike[]
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  authorId  String
  threadId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  thread    Thread   @relation(fields: [threadId], references: [id])
  author    User     @relation(fields: [authorId], references: [id])
}

model ThreadLike {
  userId    String
  threadId  String
  createdAt DateTime @default(now())
  thread    Thread   @relation(fields: [threadId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@id([userId, threadId])
}

model Category {
  id              String     @id @default(cuid())
  name            String
  slug            String
  type            String
  description     String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  metaTitle       String?
  metaDescription String?
  canonicalUrl    String?
  headline        String?
  seoContent      String?
  noIndex         Boolean    @default(false)
  blogPosts       BlogPost[]
  hooks           Hook[]
  prompts         Prompt[]
  tools           Tool[]
  scripts         Script[]

  @@unique([slug, type])
}

model Prompt {
  id              String    @id @default(cuid())
  slug            String    @unique
  title           String
  content         String
  description     String?
  model           String
  category        String
  categoryId      String?
  images          String
  image           String?
  views           Int       @default(0)
  likes           Int       @default(0)
  authorId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  metaTitle       String?
  metaDescription String?
  canonicalUrl    String?
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  tldr            String?
  noIndex         Boolean   @default(false)
  noFollow        Boolean   @default(false)
  lastUpdated     DateTime?
  promptCount     Int?
  promptType      String?
  authorName      String?
  authorBio       String?
  categoryData    Category? @relation(fields: [categoryId], references: [id])
  beforeImage     String?
  afterImage      String?
  isFeatured      Boolean   @default(false)
  author          User      @relation(fields: [authorId], references: [id])
  status          String    @default("APPROVED") // PENDING, APPROVED, REJECTED
}

model Script {
  id              String    @id @default(cuid())
  slug            String    @unique
  title           String
  content         String
  description     String?
  language        String
  image           String?
  views           Int       @default(0)
  authorId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  metaTitle       String?
  metaDescription String?
  canonicalUrl    String?
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  tldr            String?
  noIndex         Boolean   @default(false)
  noFollow        Boolean   @default(false)
  lastUpdated     DateTime?
  promptCount     Int?
  promptType      String?
  authorName      String?
  authorBio       String?
  categoryId      String?
  categoryData    Category? @relation(fields: [categoryId], references: [id])
  author          User      @relation(fields: [authorId], references: [id])
  status          String    @default("APPROVED")
}

model Hook {
  id              String    @id @default(cuid())
  slug            String    @unique
  title           String
  content         String
  description     String?
  categoryId      String?
  image           String?
  views           Int       @default(0)
  authorId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  metaTitle       String?
  metaDescription String?
  canonicalUrl    String?
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  tldr            String?
  noIndex         Boolean   @default(false)
  noFollow        Boolean   @default(false)
  lastUpdated     DateTime?
  promptCount     Int?
  promptType      String?
  authorName      String?
  authorBio       String?
  categoryData    Category? @relation(fields: [categoryId], references: [id])
  author          User      @relation(fields: [authorId], references: [id])
  status          String    @default("APPROVED")
}

model Tool {
  id              String    @id @default(cuid())
  slug            String    @unique
  title           String
  description     String?
  content         String?
  icon            String?
  link            String?
  image           String?
  categoryId      String?
  categoryData    Category? @relation(fields: [categoryId], references: [id])
  views           Int       @default(0)
  authorId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  metaTitle       String?
  metaDescription String?
  canonicalUrl    String?
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  tldr            String?
  noIndex         Boolean   @default(false)
  noFollow        Boolean   @default(false)
  lastUpdated     DateTime?
  promptCount     Int?
  promptType      String?
  authorName      String?
  authorBio       String?
  author          User      @relation(fields: [authorId], references: [id])
  status          String    @default("APPROVED")
}

model BlogPost {
  id              String    @id @default(cuid())
  slug            String    @unique
  title           String
  content         String
  excerpt         String?
  image           String?
  categoryId      String?
  published       Boolean   @default(false)
  views           Int       @default(0)
  authorId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  metaTitle       String?
  metaDescription String?
  canonicalUrl    String?
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  tldr            String?
  noIndex         Boolean   @default(false)
  noFollow        Boolean   @default(false)
  lastUpdated     DateTime?
  promptCount     Int?
  promptType      String?
  authorName      String?
  authorBio       String?
  categoryData    Category? @relation(fields: [categoryId], references: [id])
  author          User      @relation(fields: [authorId], references: [id])
  status          String    @default("APPROVED")
}

model SeoSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  type      String   @default("string")
  group     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Redirect {
  id          String   @id @default(cuid())
  source      String   @unique
  destination String
  code        Int      @default(301)
  isActive    Boolean  @default(true)
  isWildcard  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SystemSetting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  type        String   @default("string")
  category    String   @default("general")
  label       String?
  description String?
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  itemId    String
  itemType  String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, itemId, itemType])
}

model Media {
  id          String   @id @default(cuid())
  url         String
  filename    String
  altText     String?
  caption     String?
  description String?
  mimeType    String?
  size        Int?
  width       Int?
  height      Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PageBlock {
  id         String   @id @default(cuid())
  title      String?
  adminLabel String
  type       String // faq, rich_text, image_text, how_to, video, stats, cta, review
  identifier String // prompts, scripts, hooks, tools, blog, community, category:all, category:slug
  placement  String // top, bottom
  order      Int      @default(0)
  content    String // JSON string: {items: [...], config: {...}}
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier, placement, isActive])
}

// Multi-language translations for content
model ContentTranslation {
  id String @id @default(cuid())

  // Reference to the original content
  contentType String // "prompt", "script", "hook", "tool", "blog"
  contentId   String // ID of the content
  language    String // "en", "tr", "de", "es"

  // Translatable fields
  title       String
  description String?
  content     String? // For prompts, scripts, hooks, tools

  // SEO fields
  metaTitle       String?
  metaDescription String?
  ogTitle         String?
  ogDescription   String?
  seoContent      String? // Additional SEO text

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([contentType, contentId, language])
  @@index([contentType, contentId])
  @@index([language])
}

model StaticPage {
  id        String   @id @default(cuid())
  slug      String   @unique // "about", "terms", "privacy", "contact"
  title     String
  content   String // HTML/Markdown content
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Minimal SEO
  metaTitle       String?
  metaDescription String?
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type      String // "WELCOME", "SYSTEM", "LIKE", "FOLLOW"
  title     String
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([userId, isRead])
}
